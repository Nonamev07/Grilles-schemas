<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Test Supabase</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
<button id="testBtn">Toggle Case</button>

<script>
const SUPABASE_URL = "https://mrgmnarzxuursfftqwjy.supabase.co";
const SUPABASE_KEY = "sb_publishable_NRM0OYkc4C5rjUxGKruR6A_y-iKPNRm";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const player = "TEST_PLAYER";
const cell = 0;

async function loadChecked() {
  const { data, error } = await sb
    .from("cases")
    .select("checked")
    .eq("player", player)
    .eq("cell", cell)
    .maybeSingle();
  console.log("Load:", data, error);
  return data ? data.checked : false;
}

async function saveChecked(checked) {
  const { data, error } = await sb
    .from("cases")
    .upsert({ player, cell, checked }, { onConflict: "player,cell" });
  console.log("Save:", data, error);
}

const btn = document.getElementById("testBtn");
let checked = false;

(async () => {
  checked = await loadChecked();
  btn.style.background = checked ? "gray" : "white";
})();

btn.onclick = async () => {
  checked = !checked;
  btn.style.background = checked ? "gray" : "white";
  await saveChecked(checked);
};
</script>
</body>
</html>
